<!-- 518a8913-500e-4f52-83fc-c67ec309949f b5704f47-c76d-41a8-97dc-b333087615c0 -->
# UX Testing Expansion Plan (PRD-aligned)

### What we’ll cover

- **Personas & goals**: Candidate, Curator, Coach from the PRD
- **Key surfaces**: `practice-test`, `practice-lab`, `dashboard`, auth/entitlements, remediation
- **Fake-student scenarios**: Active, revoked, heavy users, new users
- **Automation**: Extend Playwright + fixtures, add a11y/perf/visual checks
- **Metrics**: Validate analytics exports and PRD success metrics

### Grounding in current code

```1:12:docs/practice-test-expansion-prd.md
# NBCOT Practice Test Expansion PRD

## 1. Background
- The current practice test experience (`src/app/practice-test/practice-test-shell.tsx:180`) delivers a rich single-test flow: local state sync, timers, reveal gating, remediation calls, CSV/JSON export, and printable summaries.
```
```184:206:src/app/practice-test/practice-test-shell.tsx
export function PracticeTestShell({
  questions,
  testId,
  testLabel,
  testSlug,
  sessionStorageKey,
  analyticsStorageKey,
}: PracticeTestShellProps) {
```
```61:74:tests/e2e/fake-student-flows.spec.ts
  test('active student can access practice lab and practice test surfaces', async ({ loginAs, logout, page }) => {
    await loginAs(ACTIVE_STUDENTS[1]);

    await test.step('Practice test landing', async () => {
      await page.goto('/practice-test');
```
```1:12:docs/testing-fake-students.md
# Fake Student Testing Checklist

This workspace now includes 30 fixture accounts ... scripts in `scripts/` help you stage different scenarios.
```

### Test matrix by persona (high impact cases)

- **Candidate (primary)**
  - Onboarding: signup/login, greet by name; persistence across reloads
  - Practice set catalog → start session → timers → reveal gating → remediation cards → submit → print/export
  - Cross-session analytics: multiple runs across sets; verify local analytics key per set
  - Error states: revoked entitlements, remediation API down/empty, missing answer keys, image missing
- **Curator**
  - Ingestion scripts produce schema-valid drafts; spot-check rationales format and book anchors
  - Schema validation failures clearly reported; staging artifacts written; diffs readable
- **Coach**
  - Exports open in Excel/Sheets; rows consistent; set IDs present; accuracy calculations consistent

### Automation upgrades

- **Expand Playwright specs**
  - Multi-run analytics: run two full sessions, confirm aggregation on `analyticsStorageKey`
  - Timer UX: pause/resume, per-question timers increment, total elapsed persists across reload
  - Reveal ergonomics: disable reveal when no selection; keyboard shortcuts (arrows, 1-9, A-D) navigate/select
  - Multi-select rules: enforce `requiredSelections`; selection limit behavior
  - Export assertions: parse downloaded JSON/CSV and assert schema + values
  - Remediation variants: stub with 0, 1, 3 items; error 500; slow response; assert fallbacks and copy
  - Image fallbacks: simulate missing public asset; ensure graceful empty state
  - Entitlements: 403 on `/api/exams/sessions` for revoked; CTAs rendered on UI surfaces
- **Visual regression**: capture key states (unanswered/selected/revealed/correct/incorrect; summary, navigator heatmap)
- **A11y pass**: axe-core checks; ARIA roles on controls; focus order; keyboard-only flow through session
- **Perf budgets**: First load `practice-test` under threshold; remediation request timeouts handled

### Fake-student data design

- Use `create-fake-students.ts` to seed 30 accounts; vary profiles:
  - New users (no analytics), light users (1 run), heavy users (3+ runs across sets), revoked users
- Add optional script to pre-seed localStorage analytics blobs for demo accounts
- Rotate revoked cohort with `revoke-fake-students.ts` to cover upsell flows

### Analytics & exports validation

- On submit, assert `testId`, `testLabel`, domain breakdown, ratios; ensure numbers match UI
- Validate CSV delimiter/escaping and stable column order across sets
- Run exports through a tiny parser and compare to ground truth derived from UI state

### Curator pipeline checks (CLI-level)

- Run `questions-check` against bundles; fail on missing keys, duplicate orders, markdown headings
- Diff report existence in `test-results/`; assert non-empty on changes

### Success metrics (from PRD)

- Track presence of set ID in analytics; vector remediation coverage at least 1 item for happy-path questions; export download flows exercised in tests

### Deliverables

- New Playwright specs covering the matrix above
- Helper utilities to simulate remediation responses and file-missing cases
- Optional: seed script to pre-populate analytics for demo walkthroughs
- Short runbook updating `docs/testing-fake-students.md` with new flows

### To-dos

- [ ] Add Playwright specs for timers, multi-select, keyboard, exports, remediation variants
- [ ] Add visual snapshots for key session states and summary views
- [ ] Run axe-core in Playwright; fix ARIA, roles, focus order where needed
- [ ] Add basic performance checks on practice-test load and remediation timing
- [ ] Assert analytics payloads and CSV/JSON export integrity
- [ ] Extend scripts to rotate revoked cohort and seed analytics blobs
- [ ] Test missing image, empty/malformed answer keys, remediation 500/timeout paths
- [ ] Automate `questions-check` and ensure diff artifacts written to test-results
- [ ] Update docs/testing-fake-students.md with new flows and commands
- [ ] When new sets land, test cross-set navigation and analytics separation